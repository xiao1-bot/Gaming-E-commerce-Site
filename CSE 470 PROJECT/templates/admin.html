{% extends "base.html" %}

{% block title %}Admin Panel - Gaming Store{% endblock %}

{% block content %}
<h2>üõ†Ô∏è Admin Panel</h2>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5>Games Management</h5>
                <a href="{{ url_for('add_game') }}" class="btn btn-primary btn-sm">Add New Game</a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Price</th>
                                <th>Genre</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for game in games %}
                            <tr>
                                <td>{{ game.title }}</td>
                                <td>${{ "%.2f"|format(game.price) }}</td>
                                <td>{{ game.genre }}</td>
                                <td>
                                    {% if game.is_available %}
                                    <span class="badge bg-success">Available</span>
                                    {% else %}
                                    <span class="badge bg-danger">Unavailable</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('edit_game', game_id=game.id) }}" class="btn btn-sm btn-warning">Edit</a>
                                    {% if not game.is_available and notify_counts[game.id] > 0 %}
                                        <form action="{{ url_for('admin_notify_users', game_id=game.id) }}" method="post" style="display:inline;">
                                            <button type="submit" class="btn btn-sm btn-info ms-2">Notify Users ({{ notify_counts[game.id] }})</button>
                                        </form>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>User Statistics</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h3 class="text-primary">{{ users|length }}</h3>
                        <p>Total Users</p>
                    </div>
                    <div class="col-6">
                        <h3 class="text-success">{{ games|length }}</h3>
                        <p>Total Games</p>
                    </div>
                </div>
                
                <h6 class="mt-4">Recent Users</h6>
                <div class="list-group">
                    {% for user in users[-5:] %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ user.username }}</strong>
                            <br><small class="text-muted">{{ user.email }}</small>
                        </div>
                        <span class="badge bg-primary">{{ user.popularity_points }} pts</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mt-4">
    <div class="card">
        <div class="card-header">
            <h5>Quick Actions</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <button class="btn btn-info w-100" onclick="sendGlobalNotification()">
                        <i class="fas fa-bell"></i><br>Send Global Notification
                    </button>
                </div>
                <div class="col-md-3">
                    <a href="{{ url_for('admin_users') }}" class="btn btn-primary w-100">
                        <i class="fas fa-users"></i><br>Manage Users
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="{{ url_for('admin_notifications') }}" class="btn btn-warning w-100">
                        <i class="fas fa-bell"></i><br>View Notifications
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="{{ url_for('admin_check_overdue') }}" class="btn btn-danger w-100">
                        <i class="fas fa-exclamation-triangle"></i><br>Check Overdue Games
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function sendGlobalNotification() {
    const message = prompt("Enter notification message for all users:");
    if (message) {
        // This would typically send a request to create notifications for all users
        alert("Global notification sent!");
    }
}
</script>
{% endblock %}
